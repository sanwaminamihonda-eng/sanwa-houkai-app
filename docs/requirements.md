# 要件定義

## 移行背景

AppSheet + Google Sheetsからの移行プロジェクト。詳細は[ADR-0002](./adr/0002-appsheet-migration.md)参照。

### 解決すべき課題（優先度順）

| 優先度 | 課題 | 解決方針 |
|--------|------|---------|
| P0 | オフライン起因のバージョン不一致 | オフライン非対応（ADR-0001） |
| P0 | 柔軟なUIが作れない | React Native + Next.js |
| P1 | PDF生成が遅い | サーバーサイド生成 |
| P1 | スケジュール機能の制限 | カスタム実装 |
| P2 | 機能追加の複雑化 | コードベースで構造化 |

## 機能要件

### 優先度定義

| 優先度 | 意味 | MVP対象 |
|--------|------|---------|
| P0 | 必須（これがないと業務不可） | Yes |
| P1 | 重要（早期に必要） | Yes |
| P2 | あると良い | No |
| P3 | 将来検討 | No |

### 訪問記録 [P0]

| 機能 | 優先度 | 備考 |
|------|--------|------|
| 訪問記録の入力 | P0 | 現場で即時入力 |
| 訪問記録の編集・削除 | P0 | 当日分のみ職員可、管理者は全て可 |
| 一覧表示・検索 | P0 | 日付、利用者、職員でフィルタ |
| AI要約生成 | P1 | Vertex AI Gemini使用 |
| 音声入力 | P2 | 運転中などの入力補助 |

### スケジュール [P0]

| 機能 | 優先度 | 備考 |
|------|--------|------|
| 日/週/月ビュー表示 | P0 | デフォルトは週ビュー |
| 作成・編集・削除 | P0 | ドラッグ&ドロップ対応 |
| 繰り返し予定 | P1 | 毎週、隔週、月次など |
| 職員別/利用者別フィルタ | P0 | 複数選択可 |
| コンフリクト検出 | P1 | 同一職員の重複予定を警告 |

### 利用者管理 [P0]

| 機能 | 優先度 | 備考 |
|------|--------|------|
| 利用者情報の登録・編集 | P0 | 基本情報、住所、連絡先 |
| 要介護度管理 | P0 | 履歴管理 |
| ケアプラン管理 | P1 | PDF添付可 |
| 一覧・検索 | P0 | 名前、要介護度でフィルタ |

### 職員管理 [P0]

| 機能 | 優先度 | 備考 |
|------|--------|------|
| 職員情報の登録・編集 | P0 | 管理者のみ |
| 資格情報管理 | P1 | 有効期限アラート |
| シフト管理 | P2 | 将来検討 |

### レポート [P1]

| 機能 | 優先度 | 備考 |
|------|--------|------|
| 月次サービス提供実績 | P1 | 介護保険請求用 |
| 利用者別/職員別実績 | P1 | 集計・グラフ表示 |
| PDF出力 | P1 | 高速生成（目標: 5秒以内） |
| Excel出力 | P2 | 外部連携用 |

### 認証・権限 [P0]

| 機能 | 優先度 | 備考 |
|------|--------|------|
| Google OAuth | P0 | 既存運用との互換性 |
| Email/Password | P1 | Google未使用ユーザー向け |
| 管理者/職員の権限分離 | P0 | 下記ルール参照 |
| 事業所単位のデータ分離 | P0 | マルチテナント |

#### 権限ルール

```
管理者:
  - 全データの読み書き
  - 職員管理
  - レポート出力
  - 設定変更

職員:
  - 自分の訪問記録の作成・編集（当日分）
  - 自分のスケジュール閲覧
  - 利用者情報の閲覧
  - 担当利用者の記録閲覧
```

## 非機能要件

| 項目 | 要件 | 測定方法 |
|------|------|---------|
| 画面表示速度 | 3秒以内 | Lighthouse |
| API応答速度 | 1秒以内 | Cloud Monitoring |
| PDF生成速度 | 5秒以内 | ログ計測 |
| 可用性 | 99.5%以上 | Uptime Check |
| データバックアップ | 日次自動 | Cloud SQL自動バックアップ |

### セキュリティ要件

| 項目 | 実装 |
|------|------|
| 通信暗号化 | HTTPS必須 |
| 認証 | Firebase Auth |
| 認可 | Row Level Security |
| 個人情報保護 | 最小権限原則 |
| 監査ログ | アクセスログ保存 |

## 画面一覧

| 画面 | 権限 | 優先度 | デバイス最適化 |
|------|------|--------|---------------|
| ログイン | 全員 | P0 | 共通 |
| ホーム（ダッシュボード） | 全員 | P0 | モバイル優先 |
| スケジュール | 全員 | P0 | タブレット優先 |
| 訪問記録入力 | 職員 | P0 | モバイル優先 |
| 訪問記録一覧 | 全員 | P0 | 共通 |
| 利用者一覧/詳細 | 全員 | P0 | 共通 |
| 職員一覧 | 管理者 | P1 | デスクトップ優先 |
| レポート | 管理者 | P1 | デスクトップ優先 |
| 設定 | 全員 | P1 | 共通 |

## UI/UX方針

### 設計原則

1. **シンプルさ優先**: 1画面1目的、最小ステップで完了
2. **モバイルファースト**: 現場での片手操作を考慮
3. **エラー予防**: 入力バリデーション、確認ダイアログ
4. **即時フィードバック**: 保存完了、エラー表示を明確に

### デバイス別最適化

| デバイス | 主な用途 | UI特徴 |
|---------|---------|--------|
| モバイル | 訪問記録入力、スケジュール確認 | 大きなタップ領域、縦スクロール |
| タブレット | スケジュール管理、記録一覧 | 2カラムレイアウト |
| デスクトップ | レポート、管理業務 | フル機能、キーボードショートカット |

## 未決定事項

| 項目 | 決定期限 | 担当 |
|------|---------|------|
| バイタル情報の具体的な項目 | MVP設計時 | 要ヒアリング |
| サービス種類マスタの初期データ | DB設計時 | 要ヒアリング |
| 画面デザイン詳細 | UI実装前 | デザイン検討 |

## AI駆動開発への指針

### 実装判断フロー

```
1. 優先度P0の機能から実装
2. 同一優先度内では、依存関係の少ないものから
3. 迷ったらこのドキュメントの優先度に従う
4. 優先度にない機能追加は確認を求める
```

### コード生成時の制約

```
- UIコンポーネントはシンプルさ優先
- 過度な抽象化を避ける
- エラーハンドリングは必須
- 型安全性を確保（TypeScript strict mode）
```
